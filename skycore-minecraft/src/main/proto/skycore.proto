syntax = "proto3";

option java_package = "org.mybad.skycoreproto";
option java_outer_classname = "SkyCoreProto";

package skycore;

message EntityMapping {
  string name = 1;
  string model = 2;
  string animation = 3;
  string texture = 4;
  string emissive = 5;
  float emissive_strength = 6;
  string bloom = 7;
  string blend_texture = 8;
  string blend_mode = 9;
  repeated float blend_color = 10;
  bool enable_cull = 11;
  float scale = 12;
  float primary_fade_seconds = 13;
  bool render_hurt_tint = 14;
  repeated float hurt_tint = 15;
  bool render_shadow = 16;
  float render_box_width = 17;
  float render_box_height = 18;
  float render_box_depth = 19;
  repeated uint32 bloom_color = 20;
  float bloom_strength = 21;
  reserved 22;
  reserved 23;
  repeated float bloom_offset = 24;
  int32 bloom_passes = 25;
  float bloom_scale_step = 26;
  float bloom_downscale = 27;
  float offset_x = 28;
  float offset_y = 29;
  float offset_z = 30;
  int32 offset_mode = 31;
  string gltf_profile = 32;
  string hash = 33;
  uint64 version = 34;
}

message MappingFile {
  string file_name = 1;
  repeated EntityMapping mappings = 2;
  bytes raw_payload = 3;
}

message HeadBarLayer {
  enum LayerType {
    IMAGE = 0;
    BAR = 1;
    TEXT = 2;
  }
  LayerType type = 1;
  string texture = 2;
  float width = 3;
  float height = 4;
  float offset_x = 5;
  float offset_y = 6;
  uint32 color = 7;
  string text = 8;
  bool shadow = 9;
  float text_scale = 10;
  string progress_expr = 11;
  bool anchor_left = 12;
}

message HeadBarDefinition {
  repeated string name_contains = 1;
  float offset = 2;
  float scale = 3;
  repeated HeadBarLayer layers = 4;
}

message HeadBarConfig {
  repeated HeadBarDefinition definitions = 1;
}

message IndicatorValue {
  double base = 1;
  string entity_uuid = 2;
  string target_uuid = 3;
}

message IndicatorColor {
  uint32 r = 1;
  uint32 g = 2;
  uint32 b = 3;
}

message CircleIndicator {
  IndicatorValue x = 1;
  IndicatorValue y = 2;
  IndicatorValue z = 3;
  IndicatorValue yaw = 4;
  int32 lifetime_ms = 5;
  IndicatorColor color = 6;
  float facing_degrees = 7;
  double radius = 8;
  int32 grow_duration_ms = 9;
  string texture = 10;
  int32 pulse_interval_ms = 11;
}

message RectangleIndicator {
  IndicatorValue x = 1;
  IndicatorValue y = 2;
  IndicatorValue z = 3;
  IndicatorValue yaw = 4;
  int32 lifetime_ms = 5;
  IndicatorColor color = 6;
  double base_width = 7;
  IndicatorValue distance = 8;
  int32 grow_duration_ms = 9;
  int32 pulse_interval_ms = 10;
}

message IndicatorVertex {
  IndicatorValue x = 1;
  IndicatorValue y = 2;
  IndicatorValue z = 3;
}

message PolygonIndicator {
  IndicatorValue x = 1;
  IndicatorValue y = 2;
  IndicatorValue z = 3;
  IndicatorValue yaw = 4;
  repeated IndicatorVertex vertices = 5;
  int32 lifetime_ms = 6;
  IndicatorColor color = 7;
}

message IndicatorCommand {
  enum Action {
    UPSERT = 0;
    REMOVE = 1;
    CLEAR_ALL = 2;
  }
  Action action = 1;
  string id = 2;
  oneof payload {
    CircleIndicator circle = 3;
    RectangleIndicator rectangle = 4;
    PolygonIndicator polygon = 5;
  }
}

message WorldActorCommand {
  enum Action {
    SPAWN = 0;
    REMOVE = 1;
    CLEAR_ALL = 2;
  }
  Action action = 1;
  string id = 2;
  string mapping_name = 3;
  double x = 4;
  double y = 5;
  double z = 6;
  float yaw = 7;
  optional string animation = 8;
  optional float scale = 9;
  optional int32 lifetime_ticks = 10;
}

message ConfigIndexEntry {
  string file_name = 1;
  bytes hash = 2;
  uint64 size = 3;
  int64 modified_at = 4;
}

message ConfigIndex {
  bytes full_hash = 1;
  repeated ConfigIndexEntry entries = 2;
}

message ConfigFileRemoved {
  string file_name = 1;
}

message ForceAnimation {
  reserved 1;
  string clip_name = 2;
  string entity_uuid = 5;
}

message GltfForceAnimation {
  string entity_uuid = 1;
  string clip_id = 2;
  float phase = 3;
  float speed = 4;
  float blend_duration = 5;
  bool loop = 6;
  bool hold_last_frame = 7;
  int64 server_time = 8;
}

message ForceSkullAnimation {
  int32 x = 1;
  int32 y = 2;
  int32 z = 3;
  string clip_name = 4;
  bool once = 5;
}

message ClearForceAnimation {
  string mapping_name = 1;
  enum Scope {
    SINGLE = 0;
    ALL = 1;
  }
  Scope scope = 2;
}

message SetModelAttributes {
  optional string mapping_name = 1;
  optional float scale = 2;
  optional float emissive_strength = 3;
  optional float bloom_strength = 4;
  reserved 5;
  optional string texture = 6;
  optional string emissive = 7;
  optional string bloom = 8;
  optional string blend_texture = 9;
  optional bool enable_cull = 10;
  optional bool render_shadow = 11;
  optional float primary_fade_seconds = 12;
  optional string entity_uuid = 13;
  repeated float bloom_offset = 14;
  optional int32 bloom_passes = 15;
  optional float bloom_scale_step = 16;
  optional float bloom_downscale = 17;
  repeated EntityAttributeOverride overrides = 18;
}

message EntityAttributeOverride {
  string entity_uuid = 1;
  optional float scale = 2;
  optional float emissive_strength = 3;
  optional float bloom_strength = 4;
  optional string texture = 5;
  optional string emissive = 6;
  optional string bloom = 7;
  optional string blend_texture = 8;
  optional bool enable_cull = 9;
  optional bool render_shadow = 10;
  optional float primary_fade_seconds = 11;
  repeated float bloom_offset = 12;
  optional int32 bloom_passes = 13;
  optional float bloom_scale_step = 14;
  optional float bloom_downscale = 15;
  optional bool reset = 16;
}

message SpawnParticle {
  string effect = 1;
  double x = 2;
  double y = 3;
  double z = 4;
  string locator = 5;
  string mapping_name = 6;
  int32 count = 7;
}

message PreloadHint {
  string group = 1;
  repeated string mapping_names = 2;
  repeated string textures = 3;
  repeated string particles = 4;
  repeated string sounds = 5;
}

message GltfProfile {
  string profile_id = 1;
  string model_path = 2;
  string texture_path = 3;
  float model_scale = 4;
  int32 fps = 5;
  double blend_duration = 6;
  repeated GltfAnimationClip animations = 7;
  string hash = 8;
  int64 version = 9;
}

message GltfAnimationClip {
  string name = 1;
  double start_time = 2;
  double end_time = 3;
  double speed = 4;
  double blend_duration = 5;
  bool loop = 6;
  bool hold_last_frame = 7;
}

message GltfProfileAssignment {
  string profile_id = 1;
  string player_name = 2;
  bool clear = 3;
}

message ClearParticles {
  string effect = 1;
  enum Scope {
    PLAYER = 0;
    WORLD = 1;
    ALL = 2;
  }
  Scope scope = 2;
}

message DebugRenderFlags {
  optional bool show_entity_boxes = 1;
  optional bool show_skull_anchors = 2;
}

message BinaryKey {
  string algorithm = 1;
  uint32 key_size = 2;
  bytes seed = 3;
  string nonce = 4;
}

message EntityAttachment {
  string attachment_id = 1;
  string target_entity_uuid = 2;
  string mapping_name = 3;
  repeated float offset = 4;
  optional bool follow_position = 5;
  optional bool follow_rotation = 6;
  optional int32 lifetime_ticks = 7;
  optional float yaw_offset = 8;
  optional string animation = 9;
  optional float scale = 10;
  optional bool world_space = 11;
  optional double world_x = 12;
  optional double world_y = 13;
  optional double world_z = 14;
  optional float world_yaw = 15;
}

message RemoveEntityAttachment {
  string attachment_id = 1;
  string target_entity_uuid = 2;
}
